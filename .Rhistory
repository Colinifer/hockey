point.padding = unit(0.3, "lines")
)
rink1 <- png::readPNG("plots/assets/slice4.png")
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1, event_detail)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
)
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
)
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
) +
bbplot::bbc_style()
pbp1 <- sc.scrape_pbp(games = 2019030145, live_scrape = T)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
) +
bbplot::bbc_style()
pbp1 <- sc.scrape_pbp(games = 2019030125, live_scrape = T)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
) +
bbplot::bbc_style()
pbp1 <- sc.scrape_pbp(games = 2019030145, live_scrape = T)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
) +
bbplot::bbc_style()
pbp1 <- sc.scrape_pbp(games = 2019030135, live_scrape = T)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
) +
bbplot::bbc_style()
paste(
pbp1$pbp_base$away_team[nrow(pbp1$pbp_base)],
"-",
pbp1$pbp_base$away_score[nrow(pbp1$pbp_base)],
"|",
pbp1$pbp_base$home_team[nrow(pbp1$pbp_base)],
"-",
pbp1$pbp_base$home_score[nrow(pbp1$pbp_base)]
)
pbp1 <- sc.scrape_pbp(games = 2019030135, live_scrape = T)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
) +
bbplot::bbc_style()
paste(
pbp1$pbp_base$away_team[nrow(pbp1$pbp_base)],
"-",
pbp1$pbp_base$away_score[nrow(pbp1$pbp_base)],
"|",
pbp1$pbp_base$home_team[nrow(pbp1$pbp_base)],
"-",
pbp1$pbp_base$home_score[nrow(pbp1$pbp_base)]
)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
# geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
)
shots,
aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
ggplot(
shots,
aes(coords_x, coords_y)
) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
)
ggplot(shots, aes(coords_x, coords_y)
) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
)
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
)
pbp1 <- sc.scrape_pbp(games = 2019030131:2019030135, live_scrape = T)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
geom_hex(binwidth = c(2.5, 2.5)) +
# scale_fill_continuous(type = "viridis") +
theme_bw() +
geom_text_repel(
data = subset(shots, event_type == "GOAL"),
aes(label = paste(event_player_1)),
size = 5,
box.padding = unit(0.35, "lines"),
point.padding = unit(0.3, "lines")
)
2019030111:2019030145
pbp1 <- sc.scrape_pbp(games = 2019030111:2019030145, live_scrape = T)
shots <- pbp1$pbp_base %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis")
source("../initR/con.R")
pbp1 <- dbGetQuery(con, "SELECT * FROM `hockey`.`pbp_base` WHERE (`season` = '20122013');")
shots <- pbp1 %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
)
dbDisconnect(con)
userDate <- Sys.Date()
userYear = substr(userDate, 1, 4)
userYear = as.int(substr(userDate, 1, 4))
userYear = as.integer(substr(userDate, 1, 4))
as.integer(substr(userDate, 5, 6))
substr(userDate, 5, 6)
substr(userDate, 6, 7)
as.integer(substr(userDate, 6, 7)) > 01
as.integer(substr(userDate, 6, 7)) > 01 & as.integer(substr(userDate, 6, 7)) < 10
as.integer(substr(userDate, 6, 7)) > 01 & as.integer(substr(userDate, 6, 7)) < 07
userDate <- Sys.Date()
userYear = if (as.integer(substr(userDate, 6, 7)) > 01 & as.integer(substr(userDate, 6, 7)) < 10) {
as.integer(substr(userDate, 1, 4)) - 1
} else {
as.integer(substr(userDate, 1, 4))
}
if (as.integer(substr(userDate, 6, 7)) > 01 & as.integer(substr(userDate, 6, 7)) < 10) {
as.integer(substr(userDate, 1, 4)) - 1
} else {
as.integer(substr(userDate, 1, 4))
}
if (as.integer(substr(userDate, 6, 7)) > 01 & as.integer(substr(userDate, 6, 7)) < 7) {
as.integer(substr(userDate, 1, 4)) - 1
} else {
as.integer(substr(userDate, 1, 4))
}
userDate <- Sys.Date()
userYear <- if (as.integer(substr(userDate, 6, 7)) > 01 & as.integer(substr(userDate, 6, 7)) < 10) {
as.integer(substr(userDate, 1, 4)) - 1
} else {
as.integer(substr(userDate, 1, 4))
}
schedule <- sc.scrape_schedule(start_date = 2020-08-11, end_date = 2020-09-11, print_sched = TRUE)
schedule <- sc.scrape_schedule(start_date = "2020-08-11", end_date = "2020-09-11", print_sched = TRUE)
View(schedule)
deparse(substitute(schedule))
dbWriteTable(
con,
value = schedule,
name = deparse(substitute(schedule)),
# name = paste0(table_names[grep(x, table_names)], "_test"),
# remove test once proven
append = TRUE
)
dbDisconnect(con)
source("../initR/con.R")
dbWriteTable(
con,
value = schedule,
name = deparse(substitute(schedule)),
# name = paste0(table_names[grep(x, table_names)], "_test"),
# remove test once proven
append = TRUE
)
dbDisconnect(con)
start_date <- "2020-08-11"
end_date <- "2020-09-30"
fschedule <- paste("schedule/", userYear, "schedule.csv", sep = "")
schedule <- sc.scrape_schedule(start_date = start_date, end_date = end_date, print_sched = TRUE)
start_date <- "2019-08-11"
end_date <- "2020-09-30"
fschedule <- paste("schedule/", userYear, "schedule.csv", sep = "")
schedule <- sc.scrape_schedule(start_date = start_date, end_date = end_date, print_sched = TRUE)
schedule %>% write_csv(fschedule)
start_date_csv <- "2019-10-01"
start_date_db <- "2019-08-11"
end_date <- "2020-09-30"
fschedule <- paste("schedule/", userYear, "schedule.csv", sep = "")
schedule <- sc.scrape_schedule(start_date = start_date_csv, end_date = end_date, print_sched = TRUE)
schedule %>% write_csv(fschedule)
pbp1 <- readRDS("data/pbp_scrape3.rds")
pbp1$pbp_base$game_id
pbp1$pbp_base$game_id[1]
pbp1 <- pbp1$pbp_base
shots <- pbp1 %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
geom_point(
aes(color = event_type),
size = 2.5
)
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis")
theme_bw()
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous()
theme_bw()
rink1 <- png::readPNG("plots/assets/nhl_rink 2.png")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis")
theme_bw()
if_else(shots$coords_x < 0, print("LEFT"), shots$coords_x)
shots$coords_x
shots$coords_x <- if_else(shots$coords_x < 0, print("LEFT"), shots$coords_x)
shots$coords_x <- if_else(shots$coords_x < 0, print("LEFT"), print("Hello"))
shots$coords_x
shots <- pbp1 %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
shots$coords_x
shots$coords_x <- if(shots$coords_x < 0) abs(shots$coords_x)
shots$coords_x <- if(shots$coords_x < 0) {abs(shots$coords_x)}
shots$coords_x
shots <- pbp1 %>% filter(event_type == "SHOT" | event_type == "GOAL") %>% filter(event_zone == "Off")
shots$coords_x <- abs(shots$coords_x)
shots$coords_x
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis", alpha(.5))
theme_bw()
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis", alpha(.25))
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis", alpha(.05))
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5), aes(alpha(.2))) +
scale_fill_continuous(type = "viridis")
ggplot(shots, aes(coords_x, coords_y), alpha = .2) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5)) +
scale_fill_continuous(type = "viridis")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5), alpha = .2) +
scale_fill_continuous(type = "viridis")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5), alpha = .5) +
scale_fill_continuous(type = "viridis")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5), alpha = .66) +
scale_fill_continuous(type = "viridis")
ggplot(shots, aes(coords_x, coords_y)) +
background_image(rink1) +
# geom_point(
#   aes(color = event_type),
#   size = 2.5
# )
# ) +
geom_hex(binwidth = c(2.5, 2.5), alpha = .75) +
scale_fill_continuous(type = "viridis")
rm(pbp1)
rm(shots)
